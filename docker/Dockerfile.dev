# --- Stage 1: Builder ---
FROM golang:1.24-alpine AS builder

# Install git (required for go mod) and build tools
RUN apk add --no-cache git

WORKDIR /app

# Download Air
RUN go install github.com/air-verse/air@latest

# Copy go mod files & download deps
COPY go.mod go.sum ./
RUN go mod download

# Copy all source files
COPY . .

# --- Stage 2: Runtime ---
FROM golang:1.24-alpine

WORKDIR /app

# Install runtime tools
RUN apk add --no-cache tzdata git

# Copy Air binary
COPY --from=builder /go/bin/air /usr/bin/air

# Copy project files
COPY . .

# Expose the port the app listens on
EXPOSE 8080

# Start with Air for hot reload
CMD ["air"]
